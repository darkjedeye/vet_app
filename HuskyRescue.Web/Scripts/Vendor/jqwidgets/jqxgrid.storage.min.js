(function(n){n.extend(n.jqx._jqxGrid.prototype,{savestate:function(t){var i=this.getstate();return t===undefined||n.isEmptyObject(t)||(t.indexOf("sort")==-1&&(delete i.sortcolumn,delete i.sortdirection),t.indexOf("pager")==-1&&(delete i.pagenum,delete i.pagesizeoptions,delete i.pagesize),t.indexOf("selection")==-1&&(delete i.selectedcells,delete i.selectedrowindexes,delete i.selectedrowindex),t.indexOf("grouping")==-1&&delete i.groups,t.indexOf("filter")==-1&&delete i.filters,n.each(this.columns.records,function(){var n=i.columns[this.datafield];t.indexOf("hidden_columns")==-1&&delete n.hidden,t.indexOf("reorder")==-1&&delete n.index,t.indexOf("columns_width")==-1&&delete n.width,t.indexOf("columns_text")==-1&&delete n.text,t.indexOf("alignment")==-1&&(delete n.align,delete n.cellsalign)})),window.localStorage&&(window.localStorage["jqxGrid"+this.element.id]=this._stringify(i)),this._savedstate=i,i},loadstate:function(t,i){var u="",s,r,o,f,e;if(t!=undefined&&t.width!=undefined?u=t:window.localStorage?(s=window.localStorage["jqxGrid"+this.element.id],s&&(u=n.parseJSON(window.localStorage["jqxGrid"+this.element.id]))):this._savedstate&&(u=this._savedstate),u!=null&&u!==""){if((this.virtualmode||this.source._source.url&&this.source._source.url!="")&&this.source.beginUpdate(),r=u,r.width!==undefined&&(this.width=r.width),r.height!==undefined&&(this.height=r.height),this.pageable&&(r.pagesize!=undefined&&(this.pagesize=r.pagesize,this.dataview.pagesize=r.pagesize),r.pagenum!=undefined&&(this.dataview.pagenum=r.pagenum),r.pagesizeoptions!=undefined&&(this.pagesizeoptions=r.pagesizeoptions),this.pagesizeoptions)){for(o=0,f=0;f<this.pagesizeoptions.length;f++)this.pagesize>=this.pagesizeoptions[f]&&(o=f);this.pagershowrowscombo&&this.pagershowrowscombo.jqxDropDownList({selectedIndex:o})}this.sortable&&(r.sortdirection?(r.sortdirection.ascending||r.sortdirection.descending)&&(this.dataview.sortfield=r.sortcolumn,e=r.sortdirection.ascending?"asc":"desc",this.dataview.sortfielddirection=e,this.source.sortcolumn=r.sortcolumn,this.source.sortdirection=e,this.autoloadstate?this.virtualmode&&(this.sortdirection=r.sortdirection,this.sortcolumn=r.sortcolumn):this.sortby(r.sortcolumn,e)):this.dataview.sortfield!=null&&(this.dataview.sortfielddirection=="asc"||this.dataview.sortfielddirection=="desc")&&this.sortby(this.dataview.sortfield,null)),this.groupable&&r.groups&&(this.dataview.groups=r.groups,this.groups=r.groups),this.loadingstate=!0,this.virtualsizeinfo&&this._loadselectionandcolumnwidths(r),this.loadingstate=!1,(this.virtualmode||this.source._source.url&&this.source._source.url!="")&&(i==!0?this.source.endUpdate(!1):(this.source.endUpdate(!1),(this.virtualmode||this.source._source.filter||this.source._source.sort)&&this.updatebounddata("state")))}},_loadselectionandcolumnwidths:function(t){var e,l,st,rt,w,nt,f,tt,o,r,y,s,c,ft,k,d,ot,h;if(this.loadingstate=!0,e="",t!=undefined&&t.width!=undefined?e=t:window.localStorage?window.localStorage["jqxGrid"+this.element.id]&&(e=n.parseJSON(window.localStorage["jqxGrid"+this.element.id])):this._savedstate&&(e=this._savedstate),e!=null&&e!=""){l=this._loading,this._loading=!1;var i=e,p=this,g=!1,a=[];if(a.length=0,st=[],n.each(this.columns.records,function(){var n=i.columns[this.datafield];n!=undefined&&(this.text!=n.text&&(g=!0),this.hidden!=n.hidden&&(g=!0),n.width!==undefined&&(this.width=n.width,this._width&&(this._width=null),this._percentagewidth&&(this._percentagewidth=null)),n.hidden!==undefined&&(this.hidden=n.hidden),n.pinned!==undefined&&(this.pinned=n.pinned),n.groupable!==undefined&&(this.groupable=n.groupable),n.resizable!==undefined&&(this.resizable=n.resizable),this.draggable=n.draggable,n.text!==undefined&&(this.text=n.text),n.align!==undefined&&(this.align=n.align),n.cellsalign!==undefined&&(this.cellsalign=n.cellsalign),n.index!==undefined&&(a[this.datafield]=n.index,a.length++))}),a.length>0){if(this.setcolumnindex){for(rt=this.rowdetails?1:0,rt+=this.groupable?this.groups.length:0,w=[],r=0;r<this.columns.records.length;r++)w.push(this.columns.records[r]);for(nt=0,r=0;r<w.length;r++){if(f=w[r],h=a[f.datafield],this.groupable&&f.grouped){nt++;continue}(r!==h||this.groupable||this.rowdetails)&&p.setcolumnindex(f.datafield,nt+h,!1)}}this.prerenderrequired=!0,this.groupable&&this._refreshdataview(),this.rendergridcontent(!0),this._updatefilterrowui&&this.filterable&&this.showfilterrow&&this._updatefilterrowui(),this._renderrows(this.virtualsizeinfo)}if(this.filterable&&i.filters!==undefined){for(this.clearfilters&&(this._loading=!1,this.clearfilters(!1)),tt="",o=new n.jqx.filter,r=0;r<i.filters.filterscount;r++){var it=i.filters["filtercondition"+r],b=i.filters["filterdatafield"+r],f=this.getcolumn(b);if(b!=tt&&(o=new n.jqx.filter),tt=b,f&&f.filterable){var u=i.filters["filtervalue"+r],ut=i.filters["filteroperator"+r],v=i.filters["filtertype"+r];if(y=v=="datefilter"?o.createfilter(v,u,it,null,f.cellsformat,this.gridlocalization):o.createfilter(v,u,it),o.addfilter(ut,y),this.showfilterrow&&(s=f._filterwidget,c=f._filterwidget.parent(),s!=null))switch(f.filtertype){case"number":c.find("input").val(u),this.host.jqxDropDownList&&(ft=o.getoperatorsbyfiltertype("numericfilter"),s.find(".filter").jqxDropDownList("selectIndex",ft.indexOf(it)));break;case"date":if(this.host.jqxDateTimeInput){var et=i.filters["filtervalue"+(r+1)],v=i.filters["filtertype"+r],y=o.createfilter(v,et,"LESS_THAN_OR_EQUAL");o.addfilter(ut,y),k=new Date(u),d=new Date(et),isNaN(k)&&(k=n.jqx.dataFormat.tryparsedate(u)),isNaN(d)&&(d=n.jqx.dataFormat.tryparsedate(u)),n(c.children()[0]).jqxDateTimeInput("setRange",k,d),r++}else s.val(u);break;case"textbox":case"default":s.val(u),p["_oldWriteText"+s[0].id]=u;break;case"list":this.host.jqxDropDownList?(ot=n(c.children()[0]).jqxDropDownList("getItems"),h=-1,n.each(ot,function(n){if(this.value==u)return h=n,!1}),n(c.children()[0]).jqxDropDownList("selectIndex",h)):s.val(u);break;case"checkedlist":this.host.jqxDropDownList||s.val(u);break;case"bool":case"boolean":this.host.jqxCheckBox?n(c.children()[0]).jqxCheckBox({checked:u}):s.val(u)}this.addfilter(b,o)}}i.filters&&i.filters.filterscount>0&&(this.applyfilters(),this.showfilterrow&&n.each(this.columns.records,function(){var e,i,o,u;if(this.filtertype=="checkedlist"&&this.filterable&&p.host.jqxDropDownList){var r=this,f=r._filterwidget,s=f.jqxDropDownList("getItems"),t=f.jqxDropDownList("listBox");if(t.checkAll(!1),r.filter){for(t.uncheckAll(!1),e=r.filter.getfilters(),i=0;i<t.items.length;i++)o=t.items[i].label,n.each(e,function(){if(this.condition=="NOT_EQUAL")return!0;o==this.value&&t.checkIndex(i,!1,!1)});t._updateCheckedItems(),u=t.getCheckedItems().length,t.items.length!=u&&u>0&&t.host.jqxListBox("indeterminateIndex",0,!0,!1)}}})),this.pageable&&i.pagenum!==undefined&&(this.gotopage&&!this.virtualmode?(this.dataview.pagenum=-1,this.gotopage(i.pagenum)):this.gotopage&&this.virtualmode&&this.gotopage(i.pagenum))}if(i.selectedrowindexes&&i.selectedrowindexes&&i.selectedrowindexes.length>0&&(this.selectedrowindexes=i.selectedrowindexes,this.selectedrowindex=i.selectedrowindex),i.selectedcells&&this._applycellselection&&n.each(i.selectedcells,function(){p._applycellselection(this.rowindex,this.datafield,!0,!1)}),this.groupable&&i.groups!==undefined){this._refreshdataview(),this.render(),this._loading=l,this.loadingstate=!1;return}if(g){if(this.prerenderrequired=!0,this.rendergridcontent(!0),this._loading=l,this.loadingstate=!1,this.updating())return!1}else this._loading=l,this._updatecolumnwidths(),this._updatecellwidths(),this.loadingstate=!1;this.loadingstate=!1,this._loading=l,this._renderrows(this.virtualsizeinfo)}this.loadingstate=!1},getstate:function(){var o=this.getdatainformation(),i={},a,s,v,u,f,e,t,c,l,p;if(i.width=this.width,i.height=this.height,i.pagenum=o.paginginformation.pagenum,i.pagesize=o.paginginformation.pagesize,i.pagesizeoptions=this.pagesizeoptions,i.sortcolumn=o.sortinformation.sortcolumn,i.sortdirection=o.sortinformation.sortdirection,this.selectionmode!=null&&this.getselectedcells&&(this.selectionmode.toString().indexOf("cell")!=-1?(a=this.getselectedcells(),s=[],n.each(a,function(){s.push({datafield:this.datafield,rowindex:this.rowindex})}),i.selectedcells=s):(v=this.getselectedrowindexes(),i.selectedrowindexes=v,i.selectedrowindex=this.selectedrowindex)),u={},f=0,this.dataview.filters)for(e=0;e<this.dataview.filters.length;e++){var h=this.dataview.filters[e].datafield,y=this.dataview.filters[e].filter,r=y.getfilters();for(u[h+"operator"]=y.operator,t=0;t<r.length;t++)r[t].datafield=h,r[t].type=="datefilter"?r[t].value&&r[t].value.toLocaleString?(c=this.getcolumn(r[t].datafield),c.cellsformat?(l=this.source.formatDate(r[t].value,c.cellsformat,this.gridlocalization),u["filtervalue"+f]=l?l:r[t].value.toLocaleString()):u["filtervalue"+f]=r[t].value.toLocaleString()):u["filtervalue"+f]=r[t].value:u["filtervalue"+f]=r[t].value,u["filtercondition"+f]=r[t].condition,u["filteroperator"+f]=r[t].operator,u["filterdatafield"+f]=h,u["filtertype"+f]=r[t].type,f++}return u.filterscount=f,i.filters=u,i.groups=this.groups,i.columns={},p=0,n.each(this.columns.records,function(){if(!this.datafield)return!0;var n={};n.width=this.width,n.hidden=this.hidden,n.pinned=this.pinned,n.groupable=this.groupable,n.resizable=this.resizable,n.draggable=this.draggable,n.text=this.text,n.align=this.align,n.cellsalign=this.cellsalign,n.index=p++,i.columns[this.datafield]=n}),i},_stringify:function(n){var i,t;if(window.JSON&&typeof window.JSON.stringify=="function"){i=this,t="";try{t=window.JSON.stringify(n)}catch(r){return i._str("",{"":n})}return t}return this._str("",{"":n})},_quote:function(n){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return'"'+n.replace(/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,function(n){var i=t[n];return typeof i=="string"?i:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"'},_stringifyArray:function(n){for(var r=n.length,i=[],t=0;t<r;t++)i.push(this._str(t,n)||"null");return"["+i.join(",")+"]"},_stringifyObject:function(n){var r=[],t,i,u=this;for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(i=u._str(t,n),i&&r.push(u._quote(t)+":"+i));return"{"+r.join(",")+"}"},_stringifyReference:function(n){switch(Object.prototype.toString.call(n)){case"[object Array]":return this._stringifyArray(n)}return this._stringifyObject(n)},_stringifyPrimitive:function(n,t){switch(t){case"string":return this._quote(n);case"number":return isFinite(n)?n:"null";case"boolean":return n}return"null"},_str:function(n,t){var i=t[n],r=typeof i;return i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(n),r=typeof i),/(number|string|boolean)/.test(r)||!i&&r==="object"?this._stringifyPrimitive(i,r):this._stringifyReference(i)}})})(jQuery);
//# sourceMappingURL=jqxgrid.storage.min.js.map