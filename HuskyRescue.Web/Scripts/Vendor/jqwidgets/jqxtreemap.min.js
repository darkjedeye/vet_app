(function(n){function r(n,t,i,r,u,f,e,o){this.label=n,this.value=t,this.parent=i,this.children=r,this.area=u||null,this.color=f,this.data=e,this.record=o}var i,t;n.jqx.jqxWidget("jqxTreeMap","",{}),i={},i["default"]=function(){function t(i,r,u,f){this.height=f,this.width=u,this.xoffset=i,this.yoffset=r,this.shortestEdge=function(){return Math.min(this.height,this.width)},this.getCoordinates=function(t){var f=[],r=this.xoffset,u=this.yoffset,e=n(t)/this.height,o=n(t)/this.width,i;if(this.width>=this.height)for(i=0;i<t.length;i+=1)f.push([r,u,r+e,u+t[i]/e]),u=u+t[i]/e;else for(i=0;i<t.length;i+=1)f.push([r,u,r+t[i]/o,u+o]),r=r+t[i]/o;return f},this.cutArea=function(n){var i,r,f,u,e;return this.width>=this.height?(r=n/this.height,f=this.width-r,i=new t(this.xoffset+r,this.yoffset,f,this.height)):(u=n/this.width,e=this.height-u,i=new t(this.xoffset,this.yoffset+u,this.width,e)),i}}function s(t,i){for(var u=[],f=n(t),e=i/f,r=0;r<t.length;r+=1)u[r]=t[r]*e;return u}function r(n,t,i,f,s){var a,c,l,h;if(f=typeof f=="undefined"?0:f,s=typeof s=="undefined"?0:s,a=[],l=[],e(n[0])){for(h=0;h<n.length;h+=1)a[h]=o(n[h]);for(c=u(a,t,i,f,s),h=0;h<n.length;h+=1)l.push(r(n[h],c[h][2]-c[h][0],c[h][3]-c[h][1],c[h][0],c[h][1]))}else l=u(n,t,i,f,s);return l}function u(n,r,u,f,e){f=typeof f=="undefined"?0:f,e=typeof e=="undefined"?0:e;var o=i(s(n,r*u),[],new t(f,e,r,u),[]);return h(o)}function h(n){for(var r=[],i,t=0;t<n.length;t+=1)for(i=0;i<n[t].length;i+=1)r.push(n[t][i]);return r}function i(t,r,u,f){var o,e,s;if(t.length===0){f.push(u.getCoordinates(r));return}return o=u.shortestEdge(),e=t[0],c(r,e,o)?(r.push(e),i(t.slice(1),r,u,f)):(s=u.cutArea(n(r),f),f.push(u.getCoordinates(r)),i(t,[],s,f)),f}function c(n,t,i){var r,u,e;return n.length===0?!0:(r=n.slice(),r.push(t),u=f(n,i),e=f(r,i),u>=e)}function f(t,i){var u=Math.min.apply(Math,t),f=Math.max.apply(Math,t),r=n(t);return Math.max(Math.pow(i,2)*f/Math.pow(r,2),Math.pow(r,2)/(Math.pow(i,2)*u))}function e(n){return n&&n.constructor===Array}function n(n){for(var i=0,t=0;t<n.length;t+=1)i+=n[t];return i}function o(t){var r=0,i;if(e(t[0]))for(i=0;i<t.length;i+=1)r+=o(t[i]);else r=n(t);return r}return r}(),t={HORIZONTAL:0,VERTICAL:1,BOTH:2},n.extend(n.jqx._jqxTreeMap.prototype,{defineInstance:function(){this.width=600,this.height=600,this.renderCallbacks={},this.legendScaleCallback=function(n){return n},this.hoverEnabled=!1,this.selectionEnabled=!0,this.singleSelection=!0,this.showLegend=!0,this.legendLabel="Legend",this.headerHeight=25,this.colorRange=100,this.layout="default",this.source=[],this.displayMember=null,this.valueMember=null,this.colorMode="parent",this.baseColor="#C2EEFF",this.legendPosition={x:0,y:0},this.colorRanges=[{color:"#aa9988",min:0,max:10},{color:"#ccbbcc",min:11,max:50},{color:"#000",min:50,max:100}],this._root=[]},createInstance:function(){this.render()},render:function(){this.host.addClass(this.toThemeProperty("jqx-widget")),this._destroy(),this._root=new r(undefined,0,null,[],this.host);var t=function(n,t){for(var f={},u,h=null,e,o,s,r=0;r<n.length;r+=1)if(n[r].items){h=!0;break}for(e=[],h&&(o=function(n,t){for(var f,s,r,u,i=0;i<n.length;i+=1){if(n[i].parent=t,n[i].data||(n[i].data=n[i].value),n[i].value==null&&(n[i].value=0),isNaN(parseFloat(n[i].value))){for(f=n[i].value.toString(),s="",r=0;r<f.length;r++)u=f.substring(r,r+1),(u.match(/^[0-9]+$/)!=null||u==".")&&(s+=u);n[i].value=new Number(s)}else n[i].value=parseFloat(n[i].value);e.push(n[i]),n[i].items&&o(n[i].items,n[i].label)}},o(n,null),n=e),r=0;r<n.length;r+=1)u=n[r],u.value&&u.parent!=null&&(f[u.parent]||(f[u.parent]=0),f[u.parent]+=u.value);for(r=0;r<n.length;r+=1)u=n[r],f[u.label]!==undefined&&(u.value=f[u.label]);t._buildTree(n,t._root),t._dataList=t._buildList(),t._setStyles(),s=i["default"],t.layout==="simple"&&(s=i.simple),t._render(t._root,s),t._renderLegend()};if(n.jqx.dataAdapter&&this.source!=null&&this.source._source){this.dataBind(this.source,t);return}t(this.source,this)},dataBind:function(t,i){var o,r,s,u,f,e,h;this.records=[],o=t._source?!0:!1,r=new n.jqx.dataAdapter(t,{autoBind:!1}),o&&(r=t,t=t._source),s=function(){t.type!=undefined&&(r._options.type=t.type),t.formatdata!=undefined&&(r._options.formatData=t.formatdata),t.contenttype!=undefined&&(r._options.contentType=t.contenttype),t.async!=undefined&&(r._options.async=t.async)},u=function(n){var f,u,t;for(n.records=r.records,f=[],u=0;u<n.records.length;u++)t=n.records[u],n.displayMember&&(t.label=t[n.displayMember]),n.valueMember&&(t.value=t[n.valueMember]),t.record=t,f.push(t);n._trigger("bindingComplete"),i(f,n)},s(this),f=this;switch(t.datatype){case"local":case"array":default:t.localdata!=null&&(r.unbindBindingUpdate(this.element.id),r.dataBind(),u(this),r.bindBindingUpdate(this.element.id,function(n){u(f,n)}));break;case"json":case"jsonp":case"xml":case"xhtml":case"script":case"text":case"csv":case"tab":if(t.localdata!=null){r.unbindBindingUpdate(this.element.id),r.dataBind(),u(this),r.bindBindingUpdate(this.element.id,function(){u(f)});return}e={},r._options.data?n.extend(r._options.data,e):(t.data&&n.extend(e,t.data),r._options.data=e),h=function(){u(f)},r.unbindDownloadComplete(f.element.id),r.bindDownloadComplete(f.element.id,h),r.dataBind()}},_destroy:function(){this.host.children().remove()},destroy:function(){this.host.remove()},refresh:function(n){n||this._refresh()},_refresh:function(){this.render()},_setStyles:function(){var i,t;this.host.css({position:"relative",width:this.width,height:this.height}),i=!1,this.width!=null&&this.width.toString().indexOf("%")!=-1&&(i=!0),this.height!=null&&this.height.toString().indexOf("%")!=-1&&(i=!0),t=this,n.jqx.utilities.resize(this.host,function(){t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t.performLayout()},10)})},performLayout:function(){var n=i["default"];this.clearSelection(),this._layout(this._root,n)},_getValues:function(n){for(var i=[],t=0;t<n.length;t+=1)i.push(n[t].value);return i},_isColor:function(n){if(!n)return!1;var t=this._colorEvaluator;return t._isRgb(n)||t._isHex(n)?!0:!1},_colorEvaluator:{_toRgb:function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},_toHex:function(n){var t=n.r.toString(16),i=n.g.toString(16),r=n.b.toString(16);return t=t.length===1?"0"+t:t,i=i.length===1?"0"+i:i,r=r.length===1?"0"+r:r,"#"+t+i+r},_isRgb:function(n){return/(rgb|rgba)\s*\(\s*\d+\s*(,\s*\d+\s*){2}(,\d+\.\d+)?\)(;?)/i.test(n)},_isHex:function(n){return/^(#([0-9A-F]{3})([0-9A-F]{3})?)$/i.test(n)},getColorByValue:function(n,t,i){var u=this._colorEvaluator,f,o,s,e,t,r;for(u._isRgb(i)&&(i=u._toHex(i)),i=u._toRgb(i),s=t.length,f=-Infinity,r=0;r<s;r+=1)f<t[r].value&&(f=t[r].value);return o=n/f,e=Math.round(o*this.colorRange),u._toHex({r:Math.max(i.r-e,0),g:Math.max(i.g-e,0),b:Math.max(i.b-e,0)})},parent:function(n){var t=n.parent.color,i=this._colorEvaluator;return n.parent?(t||(t=this.baseColor),t=i.getColorByValue.call(this,n.value,n.parent.children,t),n.color=t,t):"#fff"},autoColors:function(n){var t=this.baseColor,i=this._colorEvaluator;return t=i.getColorByValue.call(this,n.value,this._dataList,t),n.color=t,t},rangeColors:function(n){for(var r=n.value,t,i=0;i<this.colorRanges.length;i+=1)if(t=this.colorRanges[i],t.min<r&&t.max>=r)return t.color;return"#fff"}},_getColor:function(n){var t=n.color,i=this.colorMode;if(this._isColor(t))return t;if(typeof this._colorEvaluator[i]=="function")return this._colorEvaluator[i].call(this,n);throw"Invalid colorMode";},_renderRect:function(t,i){var r=n("<div/>"),u=t[2]-t[0],h=t[3]-t[1],e=this._getColor(i),o,f,s;return(r.css({position:"absolute",left:t[0]-1,top:t[1]-1,width:u,height:h,backgroundColor:e}),r.addClass(this.toThemeProperty("jqx-treemap-rectangle")),o=this._colorEvaluator,f={data:i.data,label:i.label,value:i.value,parent:i.parent,record:i.record,color:e,rgb:o._toRgb(e)},i.parent==this._root&&(f.parent=null),typeof this.renderCallbacks["*"]=="function"&&(s=this.renderCallbacks["*"](r,f),s!==undefined))?r:(typeof this.renderCallbacks[i.label]=="function"?this.renderCallbacks[i.label](r,f):(u=r.width()-2,r.html('<span style="max-width:'+u+'px;" class="jqx-treemap-label">'+i.label+"<\/span>")),r)},_centerLabel:function(n,i){var r=n[0].firstChild;r.style.position="absolute",(i===t.HORIZONTAL||i===t.BOTH)&&(r.style.left=(n[0].offsetWidth-r.offsetWidth)/2+"px"),(i===t.VERTICAL||i===t.BOTH)&&(r.style.top=(n[0].offsetHeight-r.offsetHeight)/2+"px")},_trigger:function(t,i){var r=n.Event(t);return r.args=i,this.host.trigger(r)},_addHandlers:function(t,i){var r=this;t.bind("mouseenter",function(){r.hoverEnabled&&(r.host.find(".jqx-treemap-rectangle").removeClass("jqx-treemap-rectangle-hover"),t.addClass(r.toThemeProperty("jqx-treemap-rectangle-hover"))),r._trigger("mouseenterSector",i)}),t.bind("mouseleave",function(){r.hoverEnabled&&t.removeClass("jqx-treemap-rectangle-hover"),r._trigger("mouseleaveSector",i)}),t.bind("click",function(i){if(r.selectionEnabled){var u=n.data(this,"jqx-treemap-selected")||!1;r.singleSelection&&r.host.find(".jqx-treemap-rectangle-hover").each(function(t,i){n.data(i,"jqx-treemap-selected",!1),n(i).removeClass("jqx-treemap-rectangle-hover")}),u?(t.removeClass("jqx-treemap-rectangle-hover"),u=!1):(t.addClass(r.toThemeProperty("jqx-treemap-rectangle-hover")),u=!0),n.data(this,"jqx-treemap-selected",u),i.stopImmediatePropagation()}})},clearSelection:function(){this.host.find(".jqx-treemap-rectangle-hover").removeClass(this.toThemeProperty("jqx-treemap-rectangle-hover")),n.data(this,"jqx-treemap-selected",!1)},_layoutArea:function(n,i){n.children.length&&n.children.length>0?(this._centerLabel(i,t.HORIZONTAL),i.addClass(this.toThemeProperty("jqx-treemap-rectangle-parent"))):this._centerLabel(i,t.BOTH)},_render:function(n,t){var f,u;if(n.children.length){f=0,n.value&&(f=this.headerHeight);var e=this._getValues(n.children),s=n.area.offset(),o=t(e,n.area.width(),n.area.height()-f,0,f),i,r;for(u=0;u<n.children.length;u+=1)i=n.children[u],r=this._renderRect(o[u],i),i.area=r,n.area.append(r),this._addHandlers(r,{label:i.label,value:i.value,color:i.color,sector:i.area,data:i.data}),this._layoutArea(i,r),this._render(i,t)}},_layout:function(n,t){var u,r;if(n.children.length){u=0,n.value&&(u=this.headerHeight);var f=this._getValues(n.children),o=n.area.offset(),e=t(f,n.area.width(),n.area.height()-u,0,u),i;for(r=0;r<n.children.length;r+=1)i=n.children[r],this._layoutRect(e[r],i),this._layoutArea(i,i.area),this._layout(i,t)}},_layoutRect:function(n,t){var i=t.area,r=n[2]-n[0],o=n[3]-n[1],e;i.css({left:n[0]-1,top:n[1]-1,width:r,height:o});var s=this._colorEvaluator,f=this._getColor(t),u={data:t.data,label:t.label,value:t.value,parent:t.parent,record:t.record,color:f,rgb:s._toRgb(f)};if(t.parent==this._root&&(u.parent=null),typeof this.renderCallbacks["*"]=="function"&&(e=this.renderCallbacks["*"](i,u),e!==undefined))return i;typeof this.renderCallbacks[t.label]=="function"?this.renderCallbacks[t.label](i,u):(r=i.width()-2,i.html('<span style="max-width:'+r+'px;" class="jqx-treemap-label">'+t.label+"<\/span>"))},_getBoundValues:function(){var f=this._root,t=[],n,i={},r={},u;for(i.value=f.value||Infinity,r.value=f.value||-Infinity,t.push(f);t.length;)for(n=t.pop(),i.value>n.value&&(i=n),r.value<n.value&&(r=n),u=0;u<n.children.length;u+=1)t.push(n.children[u]);return[i,r]},_getAutocolorRanges:function(){for(var i=this._getBoundValues(),r=i[1].value,u=i[0].value,f=(r-u)/5,t,e=[],n=u;n<r;n+=f)t=Math.round(n),e.push({min:t,max:n+f,color:this._colorEvaluator.getColorByValue.call(this,t,this._dataList,this.baseColor)});return e},_renderLegend:function(){var n,t;/autoColors|rangeColors/.test(this.colorMode)&&this.showLegend&&(n=this.colorRanges,this.colorMode==="autoColors"&&(n=this._getAutocolorRanges()),t=this._renderColorLegend(n),this._renderLegendLabel(t))},_renderLegendLabel:function(t){var i=n('<tr><td colspan="'+t.find("td").length/2+'"/><\/tr>'),r=n('<div class="'+this.toThemeProperty("jqx-treemap-legend-label")+'" />');r.text(this.legendLabel),i.children().append(r),t.prepend(i)},_renderColorLegend:function(t){var r=n('<div class="'+this.toThemeProperty("jqx-treemap-legend")+'"/>'),l,e,s=function(n){return n},o,a,u,c,i;typeof this.legendScaleCallback=="function"&&(s=this.legendScaleCallback),o=n('<table class="'+this.toThemeProperty("jqx-treemap-legend-table")+'"/>'),r.append(o),o.append("<tr/>"),r.append("<div/>"),this.host.append(r),l=n(r.find("tr")[0]),e=n(r.find("div")[0]),e.addClass(this.toThemeProperty("jqx-treemap-legend-values")),a=function(n,t){try{if(n.min<t.min)return-1;if(n.min>t.min)return 1}catch(i){var r=i}return 0},t.sort(a);var v=Math.round(r.width()/t.length),f=-2,h=0;for(u=0;u<t.length;u+=1)c=n('<td class="'+this.toThemeProperty("jqx-treemap-legend-color")+'"/>'),c.css("backgroundColor",t[u].color),l.append(c),u===0&&(i=n('<span class="'+this.toThemeProperty("jqx-treemap-legend-max-value")+" "+this.toThemeProperty("jqx-treemap-legend-value")+'"/>'),i.text(s(t[u].min)),e.append(i),o.css("margin-left",i.width()/2),f+=i.width()/2,h=f),i=n('<span class="'+this.toThemeProperty("jqx-treemap-legend-max-value")+" "+this.toThemeProperty("jqx-treemap-legend-value")+'"/>'),f+=v,i.text(s(t[u].max)),e.append(i),u==t.length-1&&(h+=i.width()/2,r.css("padding-right",h+5),f-=2),f-=i.width()/2,i.css("left",f),f+=i.width()/2;return r.css({position:"absolute",left:this.legendPosition.x,bottom:this.legendPosition.y,visibility:this.showLegend?"visible":"hidden"}),r},_buildTree:function(n,t){var u=null,o,i,f=[],e,s;for(f.push(t);f.length;)for(u=f.pop(),e=0;e<n.length;e+=1)i=n[e],i.parent!==u.label&&(i.parent||u.label)||(s=u,o=new r(i.label,parseFloat(i.value,10),s,[],null,i.color,i.data,i.record),u.children.push(o),f.push(o));return t},_buildList:function(){var r=[],t=[],n,i;for(t.push(this._root);t.length;)for(n=t.pop(),n!==this._root&&r.push(n),i=0;i<n.children.length;i+=1)t.push(n.children[i]);return r},propertyChangedHandler:function(n,t,i){t!=="renderCallbacks"&&(/hoverEnabled|selectionEnabled/.test(t)?i||this.host.find("jqx-treemap-rectangle-hover"):t==="showLegend"?this.host.find("jqx-treemap-legend").toggle():this._refresh())}})})(jQuery);
//# sourceMappingURL=jqxtreemap.min.js.map