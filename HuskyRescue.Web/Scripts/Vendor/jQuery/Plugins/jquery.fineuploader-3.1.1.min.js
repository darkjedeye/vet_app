var qq=function(n){"use strict";return{hide:function(){return n.style.display="none",this},attach:function(t,i){return n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i),function(){qq(n).detach(t,i)}},detach:function(t,i){return n.removeEventListener?n.removeEventListener(t,i,!1):n.attachEvent&&n.detachEvent("on"+t,i),this},contains:function(t){return n===t?!0:n.contains?n.contains(t):!!(t.compareDocumentPosition(n)&8)},insertBefore:function(t){return t.parentNode.insertBefore(n,t),this},remove:function(){return n.parentNode.removeChild(n),this},css:function(t){return t.opacity!==null&&typeof n.style.opacity!="string"&&typeof n.filters!="undefined"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(n.style,t),this},hasClass:function(t){var i=new RegExp("(^| )"+t+"( |$)");return i.test(n.className)},addClass:function(t){return qq(n).hasClass(t)||(n.className+=" "+t),this},removeClass:function(t){var i=new RegExp("(^| )"+t+"( |$)");return n.className=n.className.replace(i," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){var i,r=[];return n.querySelectorAll?n.querySelectorAll("."+t):(i=n.getElementsByTagName("*"),qq.each(i,function(n,i){qq(i).hasClass(t)&&r.push(i)}),r)},children:function(){for(var i=[],t=n.firstChild;t;)t.nodeType===1&&i.push(t),t=t.nextSibling;return i},setText:function(t){return n.innerText=t,n.textContent=t,this},clearText:function(){return qq(n).setText("")}}};qq.log=function(n,t){"use strict";window.console&&(t&&t!=="info"?window.console[t]?window.console[t](n):window.console.log("<"+t+"> "+n):window.console.log(n))},qq.isObject=function(n){"use strict";return n!==null&&n&&typeof n=="object"&&n.constructor===Object},qq.isFunction=function(n){"use strict";return typeof n=="function"},qq.isFileOrInput=function(n){"use strict";if(window.File&&n instanceof File)return!0;if(window.HTMLInputElement){if(n instanceof HTMLInputElement&&n.type&&n.type.toLowerCase()==="file")return!0}else if(n.tagName&&n.tagName.toLowerCase()==="input"&&n.type&&n.type.toLowerCase()==="file")return!0;return!1},qq.isXhrUploadSupported=function(){"use strict";var n=document.createElement("input");return n.type="file",n.multiple!==undefined&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest).upload!="undefined"},qq.isFolderDropSupported=function(n){"use strict";return n.items&&n.items[0].webkitGetAsEntry},qq.extend=function(n,t,i){"use strict";qq.each(t,function(t,r){i&&qq.isObject(r)?(n[t]===undefined&&(n[t]={}),qq.extend(n[t],r,!0)):n[t]=r})},qq.indexOf=function(n,t,i){"use strict";if(n.indexOf)return n.indexOf(t,i);i=i||0;var r=n.length;for(i<0&&(i+=r),null;i<r;i+=1)if(n.hasOwnProperty(i)&&n[i]===t)return i;return-1},qq.getUniqueId=function(){"use strict";var n=-1;return function(){return n+=1}}(),qq.ie=function(){"use strict";return navigator.userAgent.indexOf("MSIE")!==-1},qq.ie10=function(){"use strict";return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.safari=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1},qq.firefox=function(){"use strict";return navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""},qq.windows=function(){"use strict";return navigator.platform==="Win32"},qq.preventDefault=function(n){"use strict";n.preventDefault?n.preventDefault():n.returnValue=!1},qq.toElement=function(){"use strict";var n=document.createElement("div");return function(t){n.innerHTML=t;var i=n.firstChild;return n.removeChild(i),i}}(),qq.each=function(n,t){"use strict";var i,r;if(n)for(i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&(r=t(i,n[i]),r===!1))break},qq.obj2url=function(n,t,i){"use strict";var r,e,u=[],f="&",o=function(n,i){var r=t?/\[\]$/.test(t)?t:t+"["+i+"]":i;r!=="undefined"&&i!=="undefined"&&u.push(typeof n=="object"?qq.obj2url(n,r,!0):Object.prototype.toString.call(n)==="[object Function]"?encodeURIComponent(r)+"="+encodeURIComponent(n()):encodeURIComponent(r)+"="+encodeURIComponent(n))};if(!i&&t)f=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",u.push(t),u.push(qq.obj2url(n));else if(Object.prototype.toString.call(n)==="[object Array]"&&typeof n!="undefined")for(r=-1,e=n.length;r<e;r+=1)o(n[r],r);else if(typeof n!="undefined"&&n!==null&&typeof n=="object")for(r in n)n.hasOwnProperty(r)&&o(n[r],r);else u.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return t?u.join(f):u.join(f).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(n,t,i){"use strict";return t||(t=new FormData),qq.each(n,function(n,r){n=i?i+"["+n+"]":n,qq.isObject(r)?qq.obj2FormData(r,t,n):qq.isFunction(r)?t.append(encodeURIComponent(n),encodeURIComponent(r())):t.append(encodeURIComponent(n),encodeURIComponent(r))}),t},qq.obj2Inputs=function(n,t){"use strict";var i;return t||(t=document.createElement("form")),qq.obj2FormData(n,{append:function(n,r){i=document.createElement("input"),i.setAttribute("name",n),i.setAttribute("value",r),t.appendChild(i)}}),t},qq.DisposeSupport=function(){"use strict";var n=[];return{dispose:function(){var t;do t=n.shift(),t&&t();while(t)},attach:function(){var n=arguments;this.addDisposer(qq(n[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){n.push(t)}}},qq.UploadButton=function(n){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,n),this._disposeSupport=new qq.DisposeSupport,this._element=this._options.element,qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq(this._input).remove(),qq(this._element).removeClass(this._options.focusClass),this._input=this._createInput()},_createInput:function(){var n=document.createElement("input"),t;return this._options.multiple&&n.setAttribute("multiple","multiple"),this._options.acceptFiles&&n.setAttribute("accept",this._options.acceptFiles),n.setAttribute("type","file"),n.setAttribute("name",this._options.name),qq(n).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(n),t=this,this._disposeSupport.attach(n,"change",function(){t._options.onChange(n)}),this._disposeSupport.attach(n,"mouseover",function(){qq(t._element).addClass(t._options.hoverClass)}),this._disposeSupport.attach(n,"mouseout",function(){qq(t._element).removeClass(t._options.hoverClass)}),this._disposeSupport.attach(n,"focus",function(){qq(t._element).addClass(t._options.focusClass)}),this._disposeSupport.attach(n,"blur",function(){qq(t._element).removeClass(t._options.focusClass)}),window.attachEvent&&n.setAttribute("tabIndex","-1"),n}},qq.FineUploaderBasic=function(n){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!1,customHeaders:{},forceMultipart:!1,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:!0},callbacks:{onSubmit:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidate:function(){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"}},qq.extend(this._options,n,!0),this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._filesInProgress=0,this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._paramsStore=this._createParamsStore(),this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FineUploaderBasic.prototype={log:function(n,t){this._options.debug&&(!t||t==="info")?qq.log("[FineUploader] "+n):t&&t!=="info"&&qq.log("[FineUploader] "+n,t)},setParams:function(n,t){t===undefined?this._options.request.params=n:this._paramsStore.setParams(n,t)},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){"use strict";while(this._storedFileIds.length)this._filesInProgress++,this._handler.upload(this._storedFileIds.shift())},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(n){return this._onBeforeManualRetry(n)?(this._handler.retry(n),!0):!1},cancel:function(n){this._handler.cancel(n)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=0,this._storedFileIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset(),this._paramsStore.reset()},addFiles:function(n){var u=this,r=[],t,i;if(n){for(window.FileList&&n instanceof FileList||(n=[].concat(n)),t=0;t<n.length;t+=1)i=n[t],qq.isFileOrInput(i)?r.push(i):u.log(i+" is not a File or INPUT element!  Ignoring!","warn");this.log("Processing "+r.length+" files or inputs..."),this._uploadFileList(r)}},_createUploadButton:function(n){var i=this,t=new qq.UploadButton({element:n,multiple:this._options.multiple&&qq.isXhrUploadSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(n){i._onInputChange(n)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer(function(){t.dispose()}),t},_createUploadHandler:function(){var n=this,t;return t=qq.isXhrUploadSupported()?"UploadHandlerXhr":"UploadHandlerForm",new qq[t]({debug:this._options.debug,endpoint:this._options.request.endpoint,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,demoMode:this._options.demoMode,log:this.log,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,onProgress:function(t,i,r,u){n._onProgress(t,i,r,u);n._options.callbacks.onProgress(t,i,r,u)},onComplete:function(t,i,r,u){n._onComplete(t,i,r,u);n._options.callbacks.onComplete(t,i,r)},onCancel:function(t,i){n._onCancel(t,i);n._options.callbacks.onCancel(t,i)},onUpload:function(t,i,r){n._onUpload(t,i,r);n._options.callbacks.onUpload(t,i,r)},onAutoRetry:function(t,i,r,u){if(n._preventRetries[t]=r[n._options.retry.preventRetryResponseProperty],n._shouldAutoRetry(t,i,r)){n._maybeParseAndSendUploadError(t,i,r,u);n._options.callbacks.onAutoRetry(t,i,n._autoRetries[t]+1);return n._onBeforeAutoRetry(t,i),n._retryTimeouts[t]=setTimeout(function(){n._onAutoRetry(t,i,r)},n._options.retry.autoAttemptDelay*1e3),!0}return!1}})},_preventLeaveInProgress:function(){var n=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(n._filesInProgress){var t=t||window.event;return t.returnValue=n._options.messages.onLeave,n._options.messages.onLeave}})},_onSubmit:function(){this._options.autoUpload&&this._filesInProgress++},_onProgress:function(){},_onComplete:function(n,t,i,r){this._filesInProgress--,this._maybeParseAndSendUploadError(n,t,i,r)},_onCancel:function(n){clearTimeout(this._retryTimeouts[n]);var t=qq.indexOf(this._storedFileIds,n);this._options.autoUpload||t<0?this._filesInProgress--:this._options.autoUpload||this._storedFileIds.splice(t,1)},_onUpload:function(){},_onInputChange:function(n){this._handler instanceof qq.UploadHandlerXhr?this.addFiles(n.files):this._validateFile(n)&&this.addFiles(n),this._button.reset()},_onBeforeAutoRetry:function(n,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(n,t){this.log("Retrying "+t+"..."),this._autoRetries[n]++,this._handler.retry(n)},_shouldAutoRetry:function(n){return!this._preventRetries[n]&&this._options.retry.enableAuto?(this._autoRetries[n]===undefined&&(this._autoRetries[n]=0),this._autoRetries[n]<this._options.retry.maxAutoAttempts):!1},_onBeforeManualRetry:function(n){if(this._preventRetries[n])return this.log("Retries are forbidden for id "+n,"warn"),!1;if(this._handler.isValid(n)){var t=this._handler.getName(n);return this._options.callbacks.onManualRetry(n,t)===!1?!1:(this.log("Retrying upload for '"+t+"' (id: "+n+")..."),this._filesInProgress++,!0)}return this.log("'"+n+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(n,t,i,r){if(!i.success)if(r&&r.status!==200&&!i.error)this._options.callbacks.onError(n,t,"XHR returned response code "+r.status);else{var u=i.error?i.error:"Upload failure reason unknown";this._options.callbacks.onError(n,t,u)}},_uploadFileList:function(n){var i,t,r;if(i=this._getValidationDescriptors(n),r=this._options.callbacks.onValidate(i)===!1,!r)if(n.length>0){for(t=0;t<n.length;t++)if(this._validateFile(n[t]))this._uploadFile(n[t]);else if(this._options.validation.stopOnFirstInvalidFile)return}else this._error("noFilesError","")},_uploadFile:function(n){var t=this._handler.add(n),i=this._handler.getName(t);this._options.callbacks.onSubmit(t,i)!==!1&&(this._onSubmit(t,i),this._options.autoUpload?this._handler.upload(t):this._storeFileForLater(t))},_storeFileForLater:function(n){this._storedFileIds.push(n)},_validateFile:function(n){var r,t,i;if(r=this._getValidationDescriptor(n),t=r.name,i=r.size,this._options.callbacks.onValidate([r])===!1)return!1;if(this._isAllowedExtension(t)){if(i===0)return this._error("emptyError",t),!1;if(i&&this._options.validation.sizeLimit&&i>this._options.validation.sizeLimit)return this._error("sizeError",t),!1;if(i&&i<this._options.validation.minSizeLimit)return this._error("minSizeError",t),!1}else return this._error("typeError",t),!1;return!0},_error:function(n,t){function r(n,t){i=i.replace(n,t)}var i=this._options.messages[n],u=this._options.validation.allowedExtensions.join(", ");r("{file}",this._formatFileName(t)),r("{extensions}",u),r("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit)),r("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));this._options.callbacks.onError(null,t,i);return i},_formatFileName:function(n){return n.length>33&&(n=n.slice(0,19)+"..."+n.slice(-13)),n},_isAllowedExtension:function(n){var r=-1!==n.indexOf(".")?n.replace(/.*[.]/,"").toLowerCase():"",i=this._options.validation.allowedExtensions,t;if(!i.length)return!0;for(t=0;t<i.length;t++)if(i[t].toLowerCase()==r)return!0;return!1},_formatSize:function(n){var t=-1;do n=n/1024,t++;while(n>99);return Math.max(n,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]},_wrapCallbacks:function(){var n,t,i;n=this,t=function(t,i,r){try{return i.apply(n,r)}catch(u){n.log("Caught exception in '"+t+"' callback - "+u,"error")}};for(i in this._options.callbacks)(function(){var r,u;r=i,u=n._options.callbacks[r],n._options.callbacks[r]=function(){return t(r,u,arguments)}})()},_parseFileName:function(n){return n.value?n.value.replace(/.*(\/|\\)/,""):n.fileName!==null&&n.fileName!==undefined?n.fileName:n.name},_parseFileSize:function(n){var t;return n.value||(t=n.fileSize!==null&&n.fileSize!==undefined?n.fileSize:n.size),t},_getValidationDescriptor:function(n){var r,i,t;return t={},r=this._parseFileName(n),i=this._parseFileSize(n),t.name=r,i&&(t.size=i),t},_getValidationDescriptors:function(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t]);return i},_createParamsStore:function(){var n={},t=this;return{setParams:function(t,i){var r={};qq.extend(r,t),n[i]=r},getParams:function(i){var r={};return i!==undefined&&n[i]?qq.extend(r,n[i]):qq.extend(r,t._options.request.params),r},remove:function(t){return delete n[t]},reset:function(){n={}}}}},qq.DragAndDrop=function(n){"use strict";function s(){o!==f||e||(t.callbacks.log("Grabbed "+r.length+" files after tree traversal."),i.dropDisabled(!1),t.callbacks.dropProcessing(!1,r))}function l(n){r.push(n),f+=1,s()}function h(n){var i,t;o+=1,n.isFile?n.file(function(n){l(n)}):n.isDirectory&&(e=!0,i=n.createReader(),i.readEntries(function(n){for(f+=1,t=0;t<n.length;t+=1)h(n[t]);e=!1,n.length||s()}))}function a(n){var u,e,c;if(t.callbacks.dropProcessing(!0),i.dropDisabled(!0),n.files.length>1&&!t.multiple)t.callbacks.error("tooManyFilesError","");else if(r=[],o=0,f=0,qq.isFolderDropSupported(n))for(e=n.items,u=0;u<e.length;u+=1)c=e[u].webkitGetAsEntry(),c&&(c.isFile?(r.push(e[u].getAsFile()),u===e.length-1&&s()):h(c));else t.callbacks.dropProcessing(!1,n.files),i.dropDisabled(!1)}function c(n){i=new qq.UploadDropZone({element:n,onEnter:function(i){qq(n).addClass(t.classes.dropActive),i.stopPropagation()},onLeaveNotDescendants:function(){qq(n).removeClass(t.classes.dropActive)},onDrop:function(i){t.hideDropzones&&qq(n).hide(),qq(n).removeClass(t.classes.dropActive),a(i.dataTransfer)}}),u.addDisposer(function(){i.dispose()}),t.hideDropzones&&qq(n).hide()}function v(n){var t;return qq.each(n.dataTransfer.types,function(n,i){if(i==="Files")return t=!0,!1}),t}function y(){t.dropArea&&t.extraDropzones.push(t.dropArea);for(var r=t.extraDropzones,n=0;n<r.length;n+=1)c(r[n]);t.dropArea&&(!qq.ie()||qq.ie10())&&u.attach(document,"dragenter",function(u){if(!i.dropDisabled()&&v(u)){if(qq(t.dropArea).hasClass(t.classes.dropDisabled))return;for(t.dropArea.style.display="block",n=0;n<r.length;n+=1)r[n].style.display="block"}}),u.attach(document,"dragleave",function(i){if(t.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(i))for(n=0;n<r.length;n+=1)qq(r[n]).hide()}),u.attach(document,"drop",function(i){if(t.hideDropzones)for(n=0;n<r.length;n+=1)qq(r[n]).hide();i.preventDefault()})}var t,i,e,r=[],o=0,f=0,u=new qq.DisposeSupport;return t={dropArea:null,extraDropzones:[],hideDropzones:!0,multiple:!0,classes:{dropActive:null},callbacks:{dropProcessing:function(){},error:function(){},log:function(){}}},qq.extend(t,n),{setup:function(){y()},setupExtraDropzone:function(n){t.extraDropzones.push(n),c(n)},removeExtraDropzone:function(n){var i,r=t.extraDropzones;for(i in r)if(r[i]===n)return r.splice(i,1)},dispose:function(){u.dispose(),i.dispose()}}},qq.UploadDropZone=function(n){"use strict";function s(){return qq.safari()||qq.firefox()&&qq.windows()}function h(){o||(s?i.attach(document,"dragover",function(n){n.preventDefault()}):i.attach(document,"dragover",function(n){n.dataTransfer&&(n.dataTransfer.dropEffect="none",n.preventDefault())}),o=!0)}function u(n){if(qq.ie()&&!qq.ie10())return!1;var i,t=n.dataTransfer,r=qq.safari();return i=qq.ie10()?!0:t.effectAllowed!=="none",t&&i&&(t.files||!r&&t.types.contains&&t.types.contains("Files"))}function f(n){return n!==undefined&&(e=n),e}function c(){i.attach(r,"dragover",function(n){if(u(n)){var t=qq.ie()?null:n.dataTransfer.effectAllowed;n.dataTransfer.dropEffect=t==="move"||t==="linkMove"?"move":"copy",n.stopPropagation(),n.preventDefault()}}),i.attach(r,"dragenter",function(n){if(!f()){if(!u(n))return;t.onEnter(n)}}),i.attach(r,"dragleave",function(n){if(u(n)){t.onLeave(n);var i=document.elementFromPoint(n.clientX,n.clientY);if(!qq(this).contains(i))t.onLeaveNotDescendants(n)}}),i.attach(r,"drop",function(n){if(!f()){if(!u(n))return;n.preventDefault();t.onDrop(n)}})}var t,r,e,o,i=new qq.DisposeSupport;return t={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},qq.extend(t,n),r=t.element,h(),c(),{dropDisabled:function(n){return f(n)},dispose:function(){i.dispose()}}},qq.FineUploader=function(n){qq.FineUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+(!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone?'<div class="qq-upload-drop-area"><span>{dragZoneText}<\/span><\/div>':"")+(this._options.button?"":'<div class="qq-upload-button"><div>{uploadButtonText}<\/div><\/div>')+'<span class="qq-drop-processing"><span>{dropProcessingText}<\/span><span class="qq-drop-processing-spinner"><\/span><\/span>'+(this._options.listElement?"":'<ul class="qq-upload-list"><\/ul>')+"<\/div>",fileTemplate:'<li><div class="qq-progress-bar"><\/div><span class="qq-upload-spinner"><\/span><span class="qq-upload-finished"><\/span><span class="qq-upload-file"><\/span><span class="qq-upload-size"><\/span><a class="qq-upload-cancel" href="#">{cancelButtonText}<\/a><a class="qq-upload-retry" href="#">{retryButtonText}<\/a><span class="qq-upload-status-text">{statusText}<\/span><\/li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},showMessage:function(n){alert(n)}},!0),qq.extend(this._options,n,!0),this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._dnd=this._setupDragAndDrop()},qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype),qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(n){this._dnd.setupExtraDropzone(n)},removeExtraDropzone:function(n){return this._dnd.removeExtraDropzone(n)},getItemByFileId:function(n){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==n)return t;t=t.nextSibling}},cancel:function(n){qq.FineUploaderBasic.prototype.cancel.apply(this,arguments);var t=this.getItemByFileId(n);qq(t).remove()},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._bindCancelAndRetryEvents(),this._dnd.dispose(),this._dnd=this._setupDragAndDrop()},_setupDragAndDrop:function(){var n=this,r=this._find(this._element,"dropProcessing"),t,i,u;return i=function(n){n.preventDefault()},this._options.dragAndDrop.disableDefaultDropzone||(u=this._find(this._options.element,"drop")),t=new qq.DragAndDrop({dropArea:u,extraDropzones:this._options.dragAndDrop.extraDropzones,hideDropzones:this._options.dragAndDrop.hideDropzones,multiple:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{dropProcessing:function(t,u){var f=n._button.getInput();t?(qq(r).css({display:"block"}),qq(f).attach("click",i)):(qq(r).hide(),qq(f).detach("click",i)),u&&n.addFiles(u)},error:function(t,i){n._error(t,i)},log:function(t,i){n.log(t,i)}}}),t.setup(),t},_leaving_document_out:function(n){return(qq.chrome()||qq.safari()&&qq.windows())&&n.clientX==0&&n.clientY==0||qq.firefox()&&!n.relatedTarget},_storeFileForLater:function(n){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var t=this.getItemByFileId(n);qq(this._find(t,"spinner")).hide()},_find:function(n,t){var i=qq(n).getByClass(this._options.classes[t])[0];if(!i)throw new Error("element not found "+t);return i},_onSubmit:function(n,t){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(n,t)},_onProgress:function(n,t,i,r){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var u,f,e,s,h,o;u=this.getItemByFileId(n),f=this._find(u,"progressBar"),s=Math.round(i/r*100),i===r?(h=this._find(u,"cancel"),qq(h).hide(),qq(f).hide(),qq(this._find(u,"statusText")).setText(this._options.text.waitingForResponse),e=this._formatSize(r)):(e=this._formatProgress(i,r),qq(f).css({display:"block"})),qq(f).css({width:s+"%"}),o=this._find(u,"size"),qq(o).css({display:"inline"}),qq(o).setText(e)},_onComplete:function(n,t,i){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var r=this.getItemByFileId(n);qq(this._find(r,"statusText")).clearText(),qq(r).removeClass(this._classes.retrying),qq(this._find(r,"progressBar")).hide(),(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported())&&qq(this._find(r,"cancel")).hide(),qq(this._find(r,"spinner")).hide(),i.success?(qq(r).addClass(this._classes.success),this._classes.successIcon&&(this._find(r,"finished").style.display="inline-block",qq(r).addClass(this._classes.successIcon))):(qq(r).addClass(this._classes.fail),this._classes.failIcon&&(this._find(r,"finished").style.display="inline-block",qq(r).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[n]&&qq(r).addClass(this._classes.retryable),this._controlFailureTextDisplay(r,i))},_onUpload:function(n){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var t=this.getItemByFileId(n);this._showSpinner(t)},_onBeforeAutoRetry:function(n){var t,r,f,u,e,i;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments),t=this.getItemByFileId(n),r=this._find(t,"progressBar"),this._showCancelLink(t),r.style.width=0,qq(r).hide(),this._options.retry.showAutoRetryNote&&(f=this._find(t,"statusText"),u=this._autoRetries[n]+1,e=this._options.retry.maxAutoAttempts,i=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,u),i=i.replace(/\{maxAuto\}/g,e),qq(f).setText(i),u===1&&qq(t).addClass(this._classes.retrying))},_onBeforeManualRetry:function(n){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var t=this.getItemByFileId(n);return this._find(t,"progressBar").style.width=0,qq(t).removeClass(this._classes.fail),this._showSpinner(t),this._showCancelLink(t),!0}return!1},_addToList:function(n,t){var i=qq.toElement(this._options.fileTemplate),r,u;this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()&&(r=this._find(i,"cancel"),qq(r).remove()),i.qqFileId=n,u=this._find(i,"file"),qq(u).setText(this._formatFileName(t)),qq(this._find(i,"size")).hide(),this._options.multiple||this._clearList(),this._listElement.appendChild(i)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var n=this,t=this._listElement;this._disposeSupport.attach(t,"click",function(t){var i,r;if(t=t||window.event,i=t.target||t.srcElement,qq(i).hasClass(n._classes.cancel)||qq(i).hasClass(n._classes.retry)){for(qq.preventDefault(t),r=i.parentNode;r.qqFileId==undefined;)r=i=i.parentNode;qq(i).hasClass(n._classes.cancel)?n.cancel(r.qqFileId):(qq(r).removeClass(n._classes.retryable),n.retry(r.qqFileId))}})},_formatProgress:function(n,t){function r(n,t){i=i.replace(n,t)}var i=this._options.text.formatProgress;return r("{percent}",Math.round(n/t*100)),r("{total_size}",this._formatSize(t)),i},_controlFailureTextDisplay:function(n,t){var r,u,f,i,e;r=this._options.failedUploadTextDisplay.mode,u=this._options.failedUploadTextDisplay.maxChars,f=this._options.failedUploadTextDisplay.responseProperty,r==="custom"?(i=t[f],i?i.length>u&&(e=i.substring(0,u)+"..."):(i=this._options.text.failUpload,this.log("'"+f+"' is not a valid property on the server response.","warn")),qq(this._find(n,"statusText")).setText(e||i),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(n,i)):r==="default"?qq(this._find(n,"statusText")).setText(this._options.text.failUpload):r!=="none"&&this.log("failedUploadTextDisplay.mode value of '"+r+"' is not valid","warn")},_showTooltip:function(n,t){n.title=t},_showSpinner:function(n){var t=this._find(n,"spinner");t.style.display="inline-block"},_showCancelLink:function(n){if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported()){var t=this._find(n,"cancel");t.style.display="inline"}},_error:function(){var n=qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(n)}}),qq.UploadHandlerAbstract=function(n){this._options={debug:!1,endpoint:"/upload.php",paramsInBody:!1,maxConnections:999,log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onAutoRetry:function(){}},qq.extend(this._options,n),this._queue=[],this.log=this._options.log},qq.UploadHandlerAbstract.prototype={add:function(){},upload:function(n){var t=this._queue.push(n);t<=this._options.maxConnections&&this._upload(n)},retry:function(n){var t=qq.indexOf(this._queue,n);t>=0?this._upload(n):this.upload(n)},cancel:function(n){this.log("Cancelling "+n),this._options.paramsStore.remove(n),this._cancel(n),this._dequeue(n)},cancelAll:function(){for(var n=0;n<this._queue.length;n++)this._cancel(this._queue[n]);this._queue=[]},getName:function(){},getSize:function(){},getQueue:function(){return this._queue},reset:function(){this.log("Resetting upload handler"),this._queue=[]},_upload:function(){},_cancel:function(){},_dequeue:function(n){var i=qq.indexOf(this._queue,n),t,r;this._queue.splice(i,1),t=this._options.maxConnections,this._queue.length>=t&&i<t&&(r=this._queue[t-1],this._upload(r))},isValid:function(){}},qq.UploadHandlerForm=function(){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={},this._detach_load_events={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(n){n.setAttribute("name",this._options.inputName);var t=qq.getUniqueId();return this._inputs[t]=n,n.parentNode&&qq(n).remove(),t},getName:function(n){return this._inputs[n].value.replace(/.*(\/|\\)/,"")},isValid:function(n){return this._inputs[n]!==undefined},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments),this._inputs={},this._detach_load_events={}},_cancel:function(n){this._options.onCancel(n,this.getName(n));delete this._inputs[n],delete this._detach_load_events[n];var t=document.getElementById(n);t&&(t.setAttribute("src","javascript:false;"),qq(t).remove())},_upload:function(n){var r,t;this._options.onUpload(n,this.getName(n),!1);if(r=this._inputs[n],!r)throw new Error("file with passed id was not added, or already uploaded or cancelled");var f=this.getName(n),i=this._createIframe(n),u=this._createForm(i,this._options.paramsStore.getParams(n));return u.appendChild(r),t=this,this._attachLoadEvent(i,function(){t.log("iframe loaded");var r=t._getIframeContentJSON(i);if(setTimeout(function(){t._detach_load_events[n](),delete t._detach_load_events[n],qq(i).remove()},1),r.success||!t._options.onAutoRetry(n,f,r)){t._options.onComplete(n,f,r);t._dequeue(n)}}),this.log("Sending upload request for "+n),u.submit(),qq(u).remove(),n},_attachLoadEvent:function(n,t){var i=this;this._detach_load_events[n.id]=qq(n).attach("load",function(){if(i.log("Received response for "+n.id),n.parentNode){try{if(n.contentDocument&&n.contentDocument.body&&n.contentDocument.body.innerHTML=="false")return}catch(r){i.log("Error when attempting to access iframe during handling of upload response ("+r+")","error")}t()}})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response,innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+innerHTML),innerHTML&&innerHTML.match(/^<pre/i)&&(innerHTML=doc.body.firstChild.firstChild.nodeValue),response=eval("("+innerHTML+")")}catch(error){this.log("Error when attempting to parse form upload response ("+error+")","error"),response={success:!1}}return response},_createIframe:function(n){var t=qq.toElement('<iframe src="javascript:false;" name="'+n+'" />');return t.setAttribute("id",n),t.style.display="none",document.body.appendChild(t),t},_createForm:function(n,t){var u=this._options.demoMode?"GET":"POST",i=qq.toElement('<form method="'+u+'" enctype="multipart/form-data"><\/form>'),r=this._options.endpoint;return this._options.paramsInBody?qq.obj2Inputs(t,i):r=qq.obj2url(t,this._options.endpoint),i.setAttribute("action",r),i.setAttribute("target",n.name),i.style.display="none",document.body.appendChild(i),i}}),qq.UploadHandlerXhr=function(){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(n){if(!(n instanceof File))throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(n)-1},getName:function(n){var t=this._files[n];return t.fileName!==null&&t.fileName!==undefined?t.fileName:t.name},getSize:function(n){var t=this._files[n];return t.fileSize!=null?t.fileSize:t.size},getLoaded:function(n){return this._loaded[n]||0},isValid:function(n){return this._files[n]!==undefined},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},_upload:function(n){var i=this._files[n],e=this.getName(n),c=this.getSize(n),o=this,s=this._options.endpoint,h=this._options.demoMode?"GET":"POST",t,r,u,f;this._options.onUpload(n,this.getName(n),!0);this._loaded[n]=0,t=this._xhrs[n]=new XMLHttpRequest,t.upload.onprogress=function(t){if(t.lengthComputable){o._loaded[n]=t.loaded;o._options.onProgress(n,e,t.loaded,t.total)}},t.onreadystatechange=function(){t.readyState===4&&o._onComplete(n,t)},f=this._options.paramsStore.getParams(n),this._options.paramsInBody||(f[this._options.inputName]=e,s=qq.obj2url(f,this._options.endpoint)),t.open(h,s,!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("X-File-Name",encodeURIComponent(e)),t.setRequestHeader("Cache-Control","no-cache"),this._options.forceMultipart||this._options.paramsInBody?(r=new FormData,this._options.paramsInBody&&qq.obj2FormData(f,r),r.append(this._options.inputName,i),i=r):(t.setRequestHeader("Content-Type","application/octet-stream"),t.setRequestHeader("X-Mime-Type",i.type));for(u in this._options.customHeaders)this._options.customHeaders.hasOwnProperty(u)&&t.setRequestHeader(u,this._options.customHeaders[u]);this.log("Sending upload request for "+n),t.send(i)},_onComplete:function(id,xhr){"use strict";if(this._files[id]){var name=this.getName(id),size=this.getSize(id),response;this._options.onProgress(id,name,size,size);this.log("xhr - server response received for "+id),this.log("responseText = "+xhr.responseText);try{response=typeof JSON.parse=="function"?JSON.parse(xhr.responseText):eval("("+xhr.responseText+")")}catch(error){this.log("Error when attempting to parse xhr response text ("+error+")","error"),response={}}if(xhr.status===200&&response.success||!this._options.onAutoRetry(id,name,response,xhr)){this._options.onComplete(id,name,response,xhr);this._xhrs[id]=null,this._dequeue(id)}}},_cancel:function(n){this._options.onCancel(n,this.getName(n));this._files[n]=null,this._xhrs[n]&&(this._xhrs[n].abort(),this._xhrs[n]=null)}}),function(n){"use strict";var t,i,e,u,f,o,s,r,h,c;o=["uploaderType"],e=function(n){if(n){var u=r(n);s(u),f("uploaderType")==="basic"?t(new qq.FineUploaderBasic(u)):t(new qq.FineUploader(u))}return i},u=function(n,t){var r=i.data("fineuploader");if(t)r===undefined&&(r={}),r[n]=t,i.data("fineuploader",r);else return r===undefined?null:r[n]},t=function(n){return u("uploader",n)},f=function(n,t){return u(n,t)},s=function(t){var r=t.callbacks={};n.each((new qq.FineUploaderBasic)._options.callbacks,function(n){var t,u;t=/^on(\w+)/.exec(n)[1],t=t.substring(0,1).toLowerCase()+t.substring(1),u=i,r[n]=function(){var n=Array.prototype.slice.call(arguments);return u.triggerHandler(t,n)}})},r=function(t,u){var e,s;return e=u===undefined?t.uploaderType!=="basic"?{element:i[0]}:{}:u,n.each(t,function(t,i){n.inArray(t,o)>=0?f(t,i):i instanceof n?e[t]=i[0]:n.isPlainObject(i)?(e[t]={},r(i,e[t])):n.isArray(i)?(s=[],n.each(i,function(t,i){i instanceof n?n.merge(s,i):s.push(i)}),e[t]=s):e[t]=i}),u===undefined?e:void 0},h=function(i){return n.type(i)==="string"&&!i.match(/^_/)&&t()[i]!==undefined},c=function(n){var i=[],u=Array.prototype.slice.call(arguments,1);return r(u,i),t()[n].apply(t(),i)},n.fn.fineUploader=function(r){var f=this,o=arguments,u=[];return(this.each(function(s,l){if(i=n(l),t()&&h(r)){if(u.push(c.apply(f,o)),f.length===1)return!1}else typeof r!="object"&&r?n.error("Method "+r+" does not exist on jQuery.fineUploader"):e.apply(f,o)}),u.length===1)?u[0]:u.length>1?u:this}}(jQuery);
//# sourceMappingURL=jquery.fineuploader-3.1.1.min.js.map